---
# The backend ASGI worker handling websockets
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: baserow-backend-asgi
  namespace: default
  labels:
    app: baserow-backend-asgi
spec:
  interval: 15m
  chart:
    spec:
      chart: app-template
      version: 1.5.1
      sourceRef:
        kind: HelmRepository
        name: bjw-s
        namespace: flux-system
      interval: 15m
  values:
    controllers:
      main:
        containers:
          main:
            order: 1
            image:
              repository: baserow/backend
              tag: 1.20.2
              pullPolicy: IfNotPresent
            workingDir: /baserow
            args:
              - "gunicorn"
            ports:
              - targetPort: 8000
            imagePullPolicy: Always
            envFrom:
              - secretRef:
                  name: baserow-secret
    # -- Configures service settings for the chart.
    service:
      main:
        type: ClusterIP
        ports:
          http:
            port: 80
            targetPort: 8000
  # values:
  #   controllers:
  #     main:
  #       enabled: true
  #       type: deployment
  #       containers:
  #         main:
  #           nameOverride: backend-asgi
  #           image:
  #             repository: baserow/backend
  #             tag: 1.20.2
  #           workingDir: /baserow
  #           args:
  #             - "gunicorn"
  #           ports:
  #             - targetPort: 8000
  #           imagePullPolicy: Always
  #           envFrom:
  #             - secretRef:
  #                 name: baserow-secret
  #   service:
  #     main:
  #       type: ClusterIP
  #       ports:
  #         http:
  #           port: 80
  #           targetPort: 8000
