---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: authelia
  namespace: networking
spec:
  chart:
    spec:
      chart: authelia
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: authelia
        namespace: flux-system
  values:
    controller:
      replicas: 1
    image:
      registry: ghcr.io
      repository: authelia/authelia
      tag: '4.37.5'
    # command:
    #   - sh
    #   - -c
    #   - authelia --config /data/authelia/config/configuration.yaml
    service:
      main:
        ports:
          http:
            port: 9091
    persistence:
      data:
        enabled: true
        existingClaim: pvc-default
      config:
        enabled: true
        type: configMap
        name: authelia-configmap
        # subPath: configuration.yml
        # mountPath: /config/configuration.yaml
        readOnly: false
    resources:
      requests:
        cpu: 5m
        memory: 10Mi
      limits:
        memory: 100Mi
  interval: 10m0s
